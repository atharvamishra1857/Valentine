<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Be My Valentine?</title>
    <link rel="icon" type="image/png" href="favicon.png" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="pinksection" id="bg-container">
      <div class="curvedCard animate__animated animate__zoomIn">
        <img src="OJXMDX0.jpg" alt="Cute Valentine" class="cute-gif" />

        <div class="questions">
          <h1
            class="first-head animate__animated animate__pulse animate__infinite"
          >
            Will You Be My Valentine? ðŸŒ¹
          </h1>
        </div>

        <div class="button-container">
          <a href="page.html">
            <button class="btn btn-yes">Yes!!!</button>
          </a>
          <button class="btn" id="runaway-btn">No!!!</button>
        </div>
      </div>
    </div>

    <script>
      // ==========================================
      // 1. BACKGROUND DECORATION
      // ==========================================
      const bgContainer = document.getElementById("bg-container");
      const phrases = [
        "I Love You",
        "Be Mine",
        "Apsara",
        "Forever",
        "Cutie",
        "ðŸ’–",
        "ðŸ¥°",
        "ðŸŒ¹",
        "My Love",
        "Only You",
      ];

      function spawnBackgroundText() {
        const el = document.createElement("div");
        el.classList.add("bg-floater");
        el.innerText = phrases[Math.floor(Math.random() * phrases.length)];
        el.style.left = Math.random() * 90 + "vw";
        el.style.top = Math.random() * 90 + "vh";
        el.style.fontSize = Math.random() * 20 + 20 + "px";
        el.style.transform = `rotate(${Math.random() * 360}deg)`;
        bgContainer.appendChild(el);
      }
      for (let i = 0; i < 15; i++) {
        spawnBackgroundText();
      }

      // ==========================================
      // 2. FALLING HEARTS
      // ==========================================
      function createHeart() {
        const heart = document.createElement("div");
        heart.classList.add("heart");
        heart.innerText = "ðŸ’—";
        heart.style.left = Math.random() * 100 + "vw";
        heart.style.animationDuration = Math.random() * 3 + 3 + "s";
        heart.style.fontSize = Math.random() * 20 + 10 + "px";
        document.body.appendChild(heart);
        setTimeout(() => {
          heart.remove();
        }, 6000);
      }
      setInterval(createHeart, 300);

      // ==========================================
      // 3. ROBUST RUNAWAY BUTTON LOGIC
      // ==========================================
      const btn = document.getElementById("runaway-btn");
      let movedToBody = false;

      // CORE FUNCTION: Moves the button to a safe random spot
      const moveButton = () => {
        // A. MOVE TO BODY: This escapes the card's "transform" trap
        if (!movedToBody) {
          document.body.appendChild(btn);
          btn.style.position = "fixed"; // Force fixed positioning
          btn.style.zIndex = "9999"; // Float above everything
          movedToBody = true;
        }

        // B. CALCULATE SAFE AREA
        // We subtract the button size + 50px padding so it stays on screen
        const maxX = window.innerWidth - btn.offsetWidth - 50;
        const maxY = window.innerHeight - btn.offsetHeight - 50;

        // C. GENERATE RANDOM COORDINATES
        // Math.max(20, ...) ensures it doesn't go off the top/left edge
        const newX = Math.max(20, Math.random() * maxX);
        const newY = Math.max(20, Math.random() * maxY);

        // D. APPLY
        btn.style.left = `${newX}px`;
        btn.style.top = `${newY}px`;
      };

      // DESKTOP TRIGGER (Mouse over)
      btn.addEventListener("mouseover", moveButton);

      // MOBILE TRIGGER (Touch start)
      // "touchstart" happens BEFORE a click, so they can never actually click it
      btn.addEventListener("touchstart", (e) => {
        e.preventDefault(); // Prevent scrolling or clicking
        moveButton();
      });

      // ==========================================
      // 4. BACKGROUND MUSIC
      // ==========================================
      const music = document.getElementById("mySong");
      const targetVolume = 0.5; // Slightly louder than page.html
      const fadeDuration = 3000; // 3 seconds fade-in
      const volumeStep = 0.05;

      function fadeInAudio() {
        music.volume = 0;
        music
          .play()
          .then(() => {
            // Fade In Loop
            let currentVol = 0;
            const fadeInterval = setInterval(() => {
              if (currentVol < targetVolume) {
                currentVol = Math.min(currentVol + volumeStep, targetVolume);
                music.volume = currentVol;
              } else {
                clearInterval(fadeInterval);
              }
            }, 200);
          })
          .catch((err) => {
            console.log("Autoplay blocked. Waiting for user interaction.");
            // Add a one-time click listener to start music
            const startMusicOnClick = () => {
              fadeInAudio();
              document.removeEventListener("click", startMusicOnClick);
              document.removeEventListener("touchstart", startMusicOnClick);
            };
            document.addEventListener("click", startMusicOnClick);
            document.addEventListener("touchstart", startMusicOnClick);
          });
      }

      // Try allow autoplay
      window.addEventListener("load", fadeInAudio);
    </script>

    <!-- Hidden Audio Element -->
    <audio id="mySong" loop>
      <source src="Taylor Swift-Blank Space.mp3" type="audio/mp3" />
    </audio>
  </body>
</html>
